package modelo;

import java.io.FileWriter;
import java.io.PrintWriter;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

import com.mysql.jdbc.Connection;
import utilidades.ConectarV;

public class DAO {

	private Connection conexion;

	public DAO(String base) {
		ConectarV c = new ConectarV(base);
		this.conexion = c.getConexion();
	}

	private void desconectar() throws SQLException {
		this.conexion.close();
	}

	public ArrayList<Palabras> buscar() throws SQLException {
		ArrayList<Palabras> p = new ArrayList<Palabras>();

		String query = "SELECT * FROM palabras order by votos desc";
		System.out.println(query);
		PreparedStatement s;
		s = this.conexion.prepareStatement(query);
		ResultSet rs = s.executeQuery();

		while (rs.next()) {
			p.add(new Palabras(rs.getString(1), rs.getInt(2)));
		}

		rs.close();
		desconectar();
		return p;
	}

	public ArrayList<Palabras> buscarPalabra(String pal) throws SQLException {
		ArrayList<Palabras> p = new ArrayList<Palabras>();

		String query = "SELECT * FROM palabras where palabra =? order by votos desc";
		System.out.println(query);
		PreparedStatement s;
		s = this.conexion.prepareStatement(query);
		s.setString(1, pal);
		ResultSet rs = s.executeQuery();

		if (rs.next()) {
			p.add(new Palabras(rs.getString(1), rs.getInt(2)));
		}

		rs.close();
		desconectar();
		return p;
	}

	public void insertarPalabra(String campo1) throws SQLException {
		String query = "INSERT INTO palabras (palabra, votos) VALUES (?, 1)";
		System.out.println(query);
		PreparedStatement s;
		try {
			s = this.conexion.prepareStatement(query);
			s.setString(1, campo1);

			int filas = s.executeUpdate();
			System.out.println(filas);
		} catch (SQLException e) {
			System.out.println(e.getMessage());
		}

		desconectar();
	}

	public int modificar(Palabras p) throws SQLException {
		int nreg = 0;
		Statement s;
		String query = "update palabras set votos = " + (p.getVotos() + 1) + " where palabra like '" + p.getPalabra()
				+ "'";
		s = this.conexion.createStatement();
		try {
			nreg = s.executeUpdate(query);
			s.close();
			desconectar();
		} catch (SQLException e) {
			System.out.println(e.getMessage());
		}
		return nreg;
	}
	
	public void escribeFicheroArraylist (ArrayList<String> datos, boolean sw) {
		FileWriter archivo = null;
		PrintWriter pw = null;
		try {
			archivo = new FileWriter("ex2EduardoBozadaMartin\\src\\main\\webapp", sw);
			pw = new PrintWriter(archivo);
			for (String d : datos) {
				pw.println(d);
			}
		} catch (Exception e) {
			System.out.println(e.getMessage());
		}finally {
			try {
				if (archivo != null) {
					archivo.close();
				}
			} catch (Exception e2) {
				System.out.println(e2.getMessage());
			}
		}
	}
}
